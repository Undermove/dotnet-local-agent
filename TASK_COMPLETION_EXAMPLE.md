# Task Completion Agent - Примеры использования

## Описание

Task Completion Agent - это продвинутый AI-агент, который использует цикл TOTE (Test-Operate-Test-Exit) для доведения сложных задач до конца. Агент автоматически:

1. **PLAN** - Разбивает задачу на подзадачи с четкими критериями готовности
2. **ACT** - Выполняет минимально достаточные изменения
3. **OBSERVE** - Запускает проверки (build, test, lint)
4. **CRITIQUE** - Анализирует результаты и классифицирует ошибки
5. **REFLECT/UPDATE** - Обновляет план и продолжает выполнение

## Запуск

```bash
# Базовый запуск
dotnet run --project CodingAgent.Core -- complete

# С подробным логированием
dotnet run --project CodingAgent.Core -- complete --verbose

# С использованием LM Studio
dotnet run --project CodingAgent.Core -- complete --provider lmstudio --verbose
```

## Примеры задач

### 1. Создание простого класса

**Задача:** "Создай класс Calculator с методами Add, Subtract, Multiply, Divide"

**Ограничения:** "C#, .NET 9.0, с unit тестами"

Агент автоматически:
- Создаст файл Calculator.cs
- Реализует все методы
- Создаст тестовый проект
- Напишет unit тесты
- Проверит компиляцию и прохождение тестов

### 2. Рефакторинг кода

**Задача:** "Отрефактори код в файле Program.cs, выдели общую логику в отдельные методы"

**Ограничения:** "Сохрани функциональность, улучши читаемость"

Агент:
- Проанализирует существующий код
- Выделит повторяющиеся паттерны
- Создаст вспомогательные методы
- Проверит, что функциональность не нарушена

### 3. Добавление новой функциональности

**Задача:** "Добавь логирование во все методы класса UserService"

**Ограничения:** "Используй ILogger, не нарушай существующие тесты"

Агент:
- Найдет класс UserService
- Добавит dependency injection для ILogger
- Добавит логирование в каждый метод
- Обновит конструктор и тесты
- Проверит компиляцию

## Доступные инструменты

Агент имеет доступ к следующим инструментам:

### Основные инструменты
- `read_file` - Чтение файлов
- `edit_file` - Создание и редактирование файлов
- `list_files` - Просмотр содержимого директорий
- `bash_command` - Выполнение shell команд
- `code_search` - Поиск по коду

### Инструменты валидации
- `build_project` - Компиляция проекта
- `run_tests` - Запуск тестов
- `lint_code` - Проверка стиля кода
- `check_file_status` - Проверка статуса файлов

## Конфигурация

Агент поддерживает следующие настройки:

```csharp
var config = new TaskCompletionConfig
{
    MaxIterations = 50,           // Максимум итераций
    MaxSubtaskAttempts = 3,       // Попыток на подзадачу
    MaxFailedSubtasks = 5,        // Максимум неудачных подзадач
    MaxExecutionTimeMinutes = 30  // Максимальное время выполнения
};
```

## Цикл выполнения

### 1. Планирование (PLAN)
Агент создает план с подзадачами:
```json
{
  "subtasks": [
    {
      "id": "create_calculator_class",
      "description": "Create Calculator.cs with basic structure",
      "definitionOfDone": ["File exists", "Class compiles", "Has required methods"],
      "dependencies": [],
      "priority": 1,
      "estimatedComplexity": "low",
      "requiredTools": ["edit_file"]
    }
  ]
}
```

### 2. Выполнение (ACT)
Агент выбирает следующую подзадачу и выполняет её с помощью доступных инструментов.

### 3. Наблюдение (OBSERVE)
Агент автоматически запускает проверки:
- Компиляция проекта (`dotnet build`)
- Запуск тестов (`dotnet test`)
- Проверка стиля (`dotnet format`)

### 4. Критика (CRITIQUE)
Агент анализирует результаты и классифицирует ошибки:
- Compilation - ошибки компиляции
- Logic - логические ошибки в тестах
- Style - проблемы со стилем кода
- Environment - проблемы окружения

### 5. Обновление (REFLECT/UPDATE)
Агент обновляет план и решает:
- Продолжить выполнение
- Повторить подзадачу
- Попробовать альтернативный подход
- Завершить выполнение

## Преимущества

1. **Автоматическое планирование** - Агент сам разбивает сложные задачи
2. **Проверка качества** - Автоматические build/test/lint проверки
3. **Устойчивость к ошибкам** - Повторные попытки и альтернативные подходы
4. **Прозрачность** - Подробное логирование всех шагов
5. **Гибкость** - Поддержка различных типов задач и ограничений

## Ограничения

1. Требует настроенное окружение .NET
2. Зависит от качества AI модели
3. Может потребовать много итераций для сложных задач
4. Ограничен доступными инструментами

## Советы по использованию

1. **Четко формулируйте задачи** - Чем точнее описание, тем лучше результат
2. **Указывайте ограничения** - Язык, фреймворк, стиль кодирования
3. **Используйте verbose режим** - Для понимания процесса выполнения
4. **Начинайте с простых задач** - Для изучения возможностей агента
5. **Проверяйте результаты** - Агент может делать ошибки, всегда проверяйте код